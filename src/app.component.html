<!-- Phone-like container -->
<div class="w-full max-w-sm h-[800px] max-h-[95vh] bg-gray-900 text-white rounded-3xl shadow-2xl overflow-hidden flex flex-col relative">

  @if (authService.isAuthenticated()) {
    <!-- Main Application for Logged-In Users -->
    <div class="flex flex-col h-full">
      <!-- CONTEXT-AWARE HEADER -->
      @if (mainScreens.has(currentScreen())) {
        <!-- Header for main screens with bottom nav -->
        <header class="p-4 flex justify-between items-center bg-gray-900 flex-shrink-0 z-20">
          <!-- Left Icon: Menu on Home, Spacer elsewhere -->
          @if (currentScreen() === 'home') {
            <button (click)="openMenu()" class="text-3xl text-white w-8 h-8 flex items-center justify-center"><i class="ph-bold ph-list"></i></button>
          } @else {
            <div class="w-8 h-8"></div>
          }
          <!-- Title -->
          <h1 class="text-xl font-bold text-white uppercase">
            @switch(currentScreen()) {
              @case('home') { Về Thôi }
              @case('profile') { Hồ Sơ }
              @case('rewards') { Ưu Đãi }
              @case('rideHistory') { Lịch Sử }
            }
          </h1>
          <!-- Right Icon: Bell on Home, Spacer elsewhere -->
          @if (currentScreen() === 'home') {
            <button (click)="navigateTo('notifications')" class="relative text-3xl text-white w-8 h-8 flex items-center justify-center">
              <i class="ph-bold ph-bell"></i>
              @if (hasUnreadNotifications()) {
                <div class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-gray-900"></div>
              }
            </button>
          } @else {
            <div class="w-8 h-8"></div>
          }
        </header>
      } @else if (currentScreen() === 'settings' || currentScreen() === 'driverInfo' || currentScreen() === 'notifications') {
         <!-- Header for sub-screens with back button -->
         <header class="p-4 flex items-center bg-gray-900 flex-shrink-0 z-20">
            @if (currentScreen() === 'settings') {
                <button (click)="navigateTo('profile')" class="text-3xl text-white mr-4"><i class="ph-bold ph-arrow-left"></i></button>
            } @else { <!-- driverInfo, notifications -->
                <button (click)="navigateTo('home')" class="text-3xl text-white mr-4"><i class="ph-bold ph-arrow-left"></i></button>
            }
            <h1 class="text-xl font-bold text-white uppercase">
              @switch (currentScreen()) {
                @case ('settings') { Cài Đặt }
                @case ('driverInfo') { Tài Xế }
                @case ('notifications') { Thông Báo }
              }
            </h1>
        </header>
      }

      <!-- Main Content Area -->
      <div class="flex-grow relative overflow-y-auto" [class.pb-20]="mainScreens.has(currentScreen())">
        <!-- Menu Overlay -->
        @if (isMenuOpen()) {
          <div (click)="closeMenu()" class="absolute inset-0 bg-black/60 z-40 animate-fade-in"></div>
          <app-menu (close)="closeMenu()" (navigate)="navigateTo($event)" (logout)="logout()" [user]="authService.currentUser()"></app-menu>
        }

        <!-- Screen Content -->
        @switch (currentScreen()) {
          @case ('home') {
            <div class="flex flex-col h-full bg-gray-800 relative">
              <app-map 
                #map 
                (locationUpdate)="handleLocationUpdate($event)" 
                (routeFound)="bookingService.handleRouteFound($event)"
                (mapSelection)="handleMapSelection($event)"
                [selectionMode]="bookingService.activeInput()"
                class="absolute inset-0 z-0"></app-map>
              
              <!-- UI Overlay -->
              <div class="relative z-10 flex flex-col h-full pointer-events-none">
                <div class="flex-grow"></div>
                <div id="booking-card" class="bg-gray-900/80 backdrop-blur-lg m-3 p-4 rounded-2xl shadow-lg border border-gray-700/50 pointer-events-auto">
                  <!-- Input Fields -->
                  <div class="relative">
                    <div class="flex items-center mb-2">
                      <i class="ph-fill ph-circle text-brand-primary text-xl ml-1 mr-4"></i>
                      @if (locationStatus() === 'loading' && !bookingService.pickup().address) {
                        <div class="w-full bg-gray-800 text-gray-400 p-3 rounded-lg text-base flex items-center">
                          <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="O 0 24 24">
                              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          Đang tìm vị trí...
                        </div>
                      } @else {
                        <div (click)="showAddressSearch('pickup')" class="w-full bg-gray-800 text-gray-200 p-3 rounded-lg text-base cursor-pointer truncate">
                           {{ bookingService.pickup().address || 'Điểm đón của bạn' }}
                        </div>
                      }
                    </div>
                    <div class="border-l-2 border-dotted border-gray-600 h-6 w-1 ml-4 absolute left-0"></div>
                    <div class="flex items-center mt-2 relative">
                      <i class="ph-fill ph-map-pin text-red-500 text-xl ml-1 mr-4"></i>
                       <div (click)="showAddressSearch('destination')" class="w-full bg-gray-800 p-3 rounded-lg text-base cursor-pointer truncate" [class.text-gray-400]="!bookingService.destination().address" [class.text-gray-200]="bookingService.destination().address">
                           {{ bookingService.destination().address || 'Bạn muốn đi đâu?' }}
                        </div>
                    </div>
                  </div>
                  
                  @if (bookingService.activeInput()) {
                    <div class="text-center text-sm text-brand-secondary pt-2">
                      Hoặc chọn một điểm trên bản đồ
                    </div>
                  }

                  @if (bookingService.routeDetails(); as details) {
                    <div class="mt-4 pt-4 border-t border-gray-700 relative">
                      <h3 class="text-center font-bold text-lg mb-3 text-white">Chọn dịch vụ</h3>
                      <div (click)="selectService('designated_driver')" class="bg-brand-primary text-white p-3 rounded-xl mb-3 border-2 border-brand-primary cursor-pointer transition-transform duration-200 hover:scale-105">
                        <div class="flex items-center">
                          <i class="ph-bold ph-steering-wheel text-white text-3xl mr-4"></i>
                          <div><h4 class="text-lg font-bold text-white">Lái xe HỘ</h4><p class="text-gray-100 text-sm">Tài xế lái xe của bạn về.</p></div>
                          <div class="text-right ml-auto"><p class="text-lg font-bold">{{ bookingService.calculateCost('designated_driver', 'car') }}</p><p class="text-xs text-gray-200">Xe ô tô</p></div>
                        </div>
                      </div>
                      <div (click)="selectService('ride')" class="bg-gray-800 p-3 rounded-xl border-2 border-transparent cursor-pointer transition-all duration-200 hover:border-brand-secondary hover:bg-gray-700">
                        <div class="flex items-center">
                          <i class="ph-bold ph-car-profile text-brand-secondary text-3xl mr-4"></i>
                          <div><h4 class="text-lg font-bold text-white">Chở tôi về</h4><p class="text-gray-400 text-sm">Đặt một chuyến xe.</p></div>
                          <div class="text-right ml-auto"><p class="text-lg font-bold">{{ bookingService.calculateCost('ride', 'car') }}</p><p class="text-xs text-gray-400">Xe ô tô</p></div>
                        </div>
                      </div>

                      <!-- GUEST OVERLAY -->
                      @if(authService.isGuest()) {
                        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm flex flex-col items-center justify-center rounded-b-xl -m-4 mt-0 p-4">
                            <p class="text-white text-center font-semibold mb-3">Vui lòng đăng nhập để đặt xe.</p>
                            <button (click)="logout()" class="bg-brand-primary text-white px-6 py-2 rounded-lg font-semibold">
                                Đăng nhập / Đăng ký
                            </button>
                        </div>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          }
          @case ('addressSearch') {
            <div class="flex flex-col h-full bg-gray-900 p-4 animate-slide-in">
                <header class="flex items-center mb-4">
                    <button (click)="cancelSearch()" class="mr-4 text-2xl text-gray-400 hover:text-white"><i class="ph-bold ph-arrow-left"></i></button>
                    <div class="relative flex-grow">
                      <i class="ph-fill ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                      <input type="text" autofocus (input)="onSearchInput($event)" [value]="bookingService.activeInput() === 'pickup' ? bookingService.pickup().address : bookingService.destination().address" class="w-full bg-gray-800 text-gray-200 p-3 pl-10 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary" [placeholder]="bookingService.activeInput() === 'pickup' ? 'Điểm đón của bạn' : 'Bạn muốn đi đâu?'">
                    </div>
                </header>
                @if ((bookingService.searchResults().length > 0 || bookingService.isSearching())) {
                    <div class="bg-gray-800 rounded-lg max-h-[28rem] overflow-y-auto">
                      @if(bookingService.isSearching()) {
                        <div class="p-3 text-gray-400">Đang tìm...</div>
                      } @else {
                        @for(result of bookingService.searchResults(); track result.id) {
                          <div (click)="selectSearchResult(result)" class="p-3 border-b border-gray-700 cursor-pointer hover:bg-gray-700/50 flex items-center">
                            <div class="bg-gray-700 rounded-full p-3 mr-4"><i class="ph-fill ph-map-pin text-white"></i></div>
                            <div><p class="font-semibold text-white truncate">{{ result.place_name.split(',')[0] }}</p><p class="text-sm text-gray-400 truncate">{{ result.place_name }}</p></div>
                          </div>
                        }
                      }
                    </div>
                }
                <div class="mt-4"><div (click)="selectOnMap()" class="p-3 border-y border-gray-700 cursor-pointer hover:bg-gray-700/50 flex items-center text-white"><div class="bg-gray-700 rounded-full p-3 mr-4"><i class="ph-fill ph-map-trifold text-white"></i></div><span>Chọn điểm trên bản đồ</span></div></div>
                <div class="mt-6">
                  <h3 class="font-bold text-lg text-gray-300 mb-2">Đã lưu</h3>
                  <div class="space-y-2">
                    <div class="p-3 cursor-pointer hover:bg-gray-800/50 rounded-lg flex items-center text-white"><div class="bg-gray-700 rounded-full p-3 mr-4"><i class="ph-fill ph-house text-white"></i></div><span>Nhà</span></div>
                    <div class="p-3 cursor-pointer hover:bg-gray-800/50 rounded-lg flex items-center text-white"><div class="bg-gray-700 rounded-full p-3 mr-4"><i class="ph-fill ph-briefcase text-white"></i></div><span>Cơ quan</span></div>
                  </div>
                </div>
            </div>
          }
          @case ('rideVehicleType') {
            <div class="flex flex-col h-full bg-gray-900 p-5">
              <header class="flex items-center mb-6"><button (click)="goBackToHome()" class="mr-4 text-3xl text-gray-400 hover:text-white transition-colors"><i class="ph-bold ph-arrow-left"></i></button><h1 class="text-3xl font-bold">Chở tôi về</h1></header>
              <p class="text-gray-400 text-lg mb-8">Bạn muốn di chuyển bằng phương tiện nào?</p>
              <div (click)="selectRideVehicle('car')" class="bg-gray-800 p-5 rounded-xl mb-4 border-2 border-transparent cursor-pointer transition-all duration-200 hover:border-brand-secondary hover:bg-gray-700 flex justify-between items-center">
                <div class="flex items-center"><i class="ph-bold ph-car text-brand-secondary text-5xl mr-5"></i><h2 class="text-2xl font-bold text-white">Ô tô</h2></div>
                <p class="text-xl font-bold text-white">{{ bookingService.calculateCost('ride', 'car') }}</p>
              </div>
              <div (click)="selectRideVehicle('motorbike')" class="bg-gray-800 p-5 rounded-xl mb-4 border-2 border-transparent cursor-pointer transition-all duration-200 hover:border-brand-secondary hover:bg-gray-700 flex justify-between items-center">
                <div class="flex items-center"><i class="ph-bold ph-motorcycle text-brand-secondary text-5xl mr-5"></i><h2 class="text-2xl font-bold text-white">Xe máy</h2></div>
                <p class="text-xl font-bold text-white">{{ bookingService.calculateCost('ride', 'motorbike') }}</p>
              </div>
            </div>
          }
          @case ('vehicleType') {
            <div class="flex flex-col h-full bg-gray-900 p-5">
              <header class="flex items-center mb-6"><button (click)="goBackToHome()" class="mr-4 text-3xl text-gray-400 hover:text-white transition-colors"><i class="ph-bold ph-arrow-left"></i></button><h1 class="text-3xl font-bold">Lái xe HỘ</h1></header>
              <p class="text-gray-400 text-lg mb-8">Tài xế sẽ lái loại xe nào của bạn?</p>
              <div (click)="selectVehicle('car')" class="bg-gray-800 p-5 rounded-xl mb-4 border-2 border-transparent cursor-pointer transition-all duration-200 hover:border-brand-secondary hover:bg-gray-700 flex justify-between items-center">
                <div class="flex items-center"><i class="ph-bold ph-car text-brand-secondary text-5xl mr-5"></i><h2 class="text-2xl font-bold text-white">Ô tô của bạn</h2></div>
                <p class="text-xl font-bold text-white">{{ bookingService.calculateCost('designated_driver', 'car') }}</p>
              </div>
              <div (click)="selectVehicle('motorbike')" class="bg-gray-800 p-5 rounded-xl mb-4 border-2 border-transparent cursor-pointer transition-all duration-200 hover:border-brand-secondary hover:bg-gray-700 flex justify-between items-center">
                <div class="flex items-center"><i class="ph-bold ph-motorcycle text-brand-secondary text-5xl mr-5"></i><h2 class="text-2xl font-bold text-white">Xe máy của bạn</h2></div>
                <p class="text-xl font-bold text-white">{{ bookingService.calculateCost('designated_driver', 'motorbike') }}</p>
              </div>
            </div>
          }
          @case ('payment') {
            <div class="flex flex-col h-full bg-gray-900 p-5 animate-slide-in">
              <header class="flex items-center mb-6"><button (click)="goBackToVehicleSelection()" class="mr-4 text-3xl text-gray-400 hover:text-white transition-colors"><i class="ph-bold ph-arrow-left"></i></button><h1 class="text-3xl font-bold">Thanh toán</h1></header>
              <p class="text-gray-400 text-lg mb-8">Chọn phương thức thanh toán.</p>
              <div class="space-y-4">
                <div (click)="selectedPaymentMethod.set('cash')" class="bg-gray-800 p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 flex items-center" [class.border-brand-secondary]="selectedPaymentMethod() === 'cash'" [class.border-transparent]="selectedPaymentMethod() !== 'cash'"><i class="ph-bold ph-money text-brand-primary text-4xl mr-4"></i><div><h2 class="text-xl font-bold text-white">Tiền mặt</h2><p class="text-gray-400 text-sm">Thanh toán trực tiếp cho tài xế</p></div></div>
                <div (click)="selectedPaymentMethod.set('card')" class="bg-gray-800 p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 flex items-center" [class.border-brand-secondary]="selectedPaymentMethod() === 'card'" [class.border-transparent]="selectedPaymentMethod() !== 'card'"><i class="ph-bold ph-credit-card text-blue-400 text-4xl mr-4"></i><div><h2 class="text-xl font-bold text-white">Thẻ tín dụng</h2><p class="text-gray-400 text-sm">**** **** **** 1234</p></div></div>
                <div (click)="selectedPaymentMethod.set('ewallet')" class="bg-gray-800 p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 flex items-center" [class.border-brand-secondary]="selectedPaymentMethod() === 'ewallet'" [class.border-transparent]="selectedPaymentMethod() !== 'ewallet'"><i class="ph-bold ph-qr-code text-purple-400 text-4xl mr-4"></i><div><h2 class="text-xl font-bold text-white">Ví điện tử</h2><p class="text-gray-400 text-sm">Sử dụng số dư ví Về Thôi</p></div></div>
              </div>
              <div class="mt-auto">
                <div class="flex justify-between items-center text-lg mb-4"><span class="text-gray-400">Tổng cộng</span><span class="text-2xl font-bold text-white">{{ totalCost() }}</span></div>
                <button (click)="proceedToConfirmation()" class="w-full bg-brand-primary text-white p-4 rounded-xl font-semibold text-lg hover:bg-green-700 transition-colors">Xác nhận đặt xe</button>
              </div>
            </div>
          }
          @case ('inRide') { <app-in-ride (cancel)="handleTripCancellation()"></app-in-ride> }
          @case ('profile') { <app-profile (navigateToSettings)="navigateTo('settings')"></app-profile> }
          @case ('settings') { <app-settings></app-settings> }
          @case ('rewards') { <app-rewards></app-rewards> }
          @case ('rideHistory') { <app-ride-history></app-ride-history> }
          @case ('driverInfo') { <app-driver-info></app-driver-info> }
          @case ('notifications') { <app-notifications></app-notifications> }
        }
      </div>
      
      <!-- BOTTOM NAVIGATION -->
      @if (mainScreens.has(currentScreen())) {
        <nav class="absolute bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 grid grid-cols-4 pointer-events-auto z-20">
          <button (click)="navigateTo('home')" class="flex flex-col items-center justify-center p-2 transition-colors" [class.text-brand-primary]="currentScreen() === 'home'" [class.text-gray-400]="currentScreen() !== 'home'">
            <i class="ph-bold ph-house text-2xl"></i>
            <span class="text-xs font-medium mt-1">Trang chủ</span>
          </button>
          <button (click)="navigateTo('rideHistory')" class="flex flex-col items-center justify-center p-2 transition-colors" [class.text-brand-primary]="currentScreen() === 'rideHistory'" [class.text-gray-400]="currentScreen() !== 'rideHistory'">
            <i class="ph-bold ph-clock-counter-clockwise text-2xl"></i>
            <span class="text-xs font-medium mt-1">Lịch sử</span>
          </button>
          <button (click)="navigateTo('rewards')" class="flex flex-col items-center justify-center p-2 transition-colors" [class.text-brand-primary]="currentScreen() === 'rewards'" [class.text-gray-400]="currentScreen() !== 'rewards'">
            <i class="ph-bold ph-gift text-2xl"></i>
            <span class="text-xs font-medium mt-1">Ưu đãi</span>
          </button>
          <button (click)="navigateTo('profile')" class="flex flex-col items-center justify-center p-2 transition-colors" [class.text-brand-primary]="currentScreen() === 'profile'" [class.text-gray-400]="currentScreen() !== 'profile'">
            <i class="ph-bold ph-user-circle text-2xl"></i>
            <span class="text-xs font-medium mt-1">Hồ sơ</span>
          </button>
        </nav>
      }
    </div>
  } @else {
    <!-- Authentication Flow -->
    <div class="flex flex-col h-full bg-gray-900">
      @switch (currentScreen()) {
        @case ('welcome') {
          <div class="flex flex-col h-full justify-center items-center text-center p-8 bg-gray-900">
            <i class="ph-bold ph-steering-wheel text-brand-primary text-8xl mb-6"></i>
            <h1 class="text-4xl font-bold text-white mb-2">Về Thôi</h1>
            <p class="text-lg text-gray-300 mb-10">An toàn cho bạn, an tâm cho xe.</p>
            <div class="w-full max-w-xs space-y-3">
              <button (click)="login(true)" class="w-full bg-white text-gray-800 p-3 rounded-xl font-semibold text-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                 <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.021,35.596,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                 Tiếp tục với Google
              </button>
              <button (click)="navigateTo('phoneAuth')" class="w-full bg-gray-700 text-white p-3 rounded-xl font-semibold text-lg hover:bg-gray-600 transition-colors flex items-center justify-center">
                <i class="ph-bold ph-phone text-2xl mr-3"></i>
                Tiếp tục với số điện thoại
              </button>
              <button (click)="navigateTo('login')" class="w-full bg-gray-700 text-white p-3 rounded-xl font-semibold text-lg hover:bg-gray-600 transition-colors flex items-center justify-center">
                <i class="ph-bold ph-envelope-simple text-2xl mr-3"></i>
                Tiếp tục với Email
              </button>
            </div>
            <button (click)="loginAsGuest()" class="w-full max-w-xs text-brand-secondary p-3 mt-4 rounded-xl font-semibold text-base hover:bg-gray-800 transition-colors">
                Đăng nhập với tư cách Khách
            </button>
          </div>
        }
        @case ('phoneAuth') {
          <div class="flex flex-col h-full justify-center p-8 bg-gray-900">
            <button (click)="navigateTo('welcome')" class="absolute top-5 left-5 text-2xl text-gray-400 hover:text-white"><i class="ph-bold ph-arrow-left"></i></button>
            <h2 class="text-3xl font-bold text-white mb-2">Nhập số điện thoại</h2>
            <p class="text-gray-400 mb-8">Chúng tôi sẽ gửi cho bạn một mã xác nhận.</p>
            <form (submit)="login(true); $event.preventDefault()" class="space-y-6">
              <input type="tel" placeholder="Số điện thoại" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
               <input type="text" placeholder="Mã OTP" class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <button type="submit" class="w-full bg-brand-primary text-white p-4 rounded-xl font-semibold text-lg hover:bg-green-700 transition-colors">Xác nhận</button>
            </form>
          </div>
        }
        @case ('login') {
          <div class="flex flex-col h-full justify-center p-8 bg-gray-900">
            <button (click)="navigateTo('welcome')" class="absolute top-5 left-5 text-2xl text-gray-400 hover:text-white"><i class="ph-bold ph-arrow-left"></i></button>
            <h2 class="text-3xl font-bold text-white mb-8">Đăng nhập</h2>
            <form (submit)="login(true); $event.preventDefault()" class="space-y-6">
              <input type="email" placeholder="Email" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <input type="password" placeholder="Mật khẩu" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <button type="submit" class="w-full bg-brand-primary text-white p-4 rounded-xl font-semibold text-lg hover:bg-green-700 transition-colors">Đăng nhập</button>
            </form>
            <p class="text-center text-gray-400 mt-6">
              Chưa có tài khoản? <button (click)="navigateTo('signup')" class="font-semibold text-brand-secondary hover:underline">Đăng ký</button>
            </p>
          </div>
        }
        @case ('signup') {
          <div class="flex flex-col h-full justify-center p-8 bg-gray-900">
            <button (click)="navigateTo('welcome')" class="absolute top-5 left-5 text-2xl text-gray-400 hover:text-white"><i class="ph-bold ph-arrow-left"></i></button>
            <h2 class="text-3xl font-bold text-white mb-8">Tạo tài khoản</h2>
            <form (submit)="signup(true); $event.preventDefault()" class="space-y-6">
               <input type="text" placeholder="Họ và tên" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <input type="email" placeholder="Email" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <input type="password" placeholder="Mật khẩu" required class="w-full bg-gray-800 text-gray-200 p-4 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-brand-secondary">
              <button type="submit" class="w-full bg-brand-primary text-white p-4 rounded-xl font-semibold text-lg hover:bg-green-700 transition-colors">Đăng ký</button>
            </form>
            <p class="text-center text-gray-400 mt-6">
              Đã có tài khoản? <button (click)="navigateTo('login')" class="font-semibold text-brand-secondary hover:underline">Đăng nhập</button>
            </p>
          </div>
        }
      }
    </div>
  }

  <!-- Payment Confirmation Modal -->
  @if (showPaymentModal()) {
    <div class="absolute inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in">
      <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-sm border border-gray-700 animate-scale-up">
        <h2 class="text-2xl font-bold text-center text-white mb-6">Xác nhận chuyến đi</h2>
        <div class="space-y-3 text-base">
          <div class="flex justify-between items-center"><span class="text-gray-400">Dịch vụ</span><span class="font-semibold text-white">{{ serviceName() }}</span></div>
          <div class="flex justify-between items-center"><span class="text-gray-400">Phương tiện</span><span class="font-semibold text-white">{{ vehicleName() }}</span></div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Thanh toán qua</span>
            @switch (selectedPaymentMethod()) {
              @case ('cash') { <span class="font-semibold text-white">Tiền mặt</span> }
              @case ('card') { <span class="font-semibold text-white">Thẻ</span> }
              @case ('ewallet') { <span class="font-semibold text-white">Ví điện tử</span> }
            }
          </div>
          <div class="border-t border-gray-700 my-4"></div>
          <div class="flex justify-between items-center text-xl"><span class="text-gray-300">Tổng cộng</span><span class="font-bold text-brand-secondary text-2xl">{{ totalCost() }}</span></div>
        </div>
        <div class="mt-8 grid grid-cols-2 gap-3">
          <button (click)="cancelPaymentConfirmation()" class="bg-gray-700 text-white p-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">Huỷ</button>
          <button (click)="confirmPayment()" class="bg-brand-primary text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">Xác nhận</button>
        </div>
      </div>
    </div>
  }
</div>
<style>
  @keyframes slide-in { from { transform: translateX(100%); opacity: 0.8; } to { transform: translateX(0); opacity: 1; } }
  .animate-slide-in { animation: slide-in 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
  @keyframes slide-in-left { from { transform: translateX(-100%); } to { transform: translateX(0); } }
  .animate-slide-in-left { animation: slide-in-left 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
  @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
  .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
  @keyframes scale-up { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .animate-scale-up { animation: scale-up 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
</style>